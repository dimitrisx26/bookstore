<div class="container py-5 text-center">
  <!-- Hero -->
  <h1 class="h4 fw-bold mb-2">Search to find your new book</h1>
  <p class="text-muted mb-3">
    Search for books by title, author, or ISBN to find your next great read.
  </p>
  <!-- END Hero -->

  <!-- Search input -->
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="search-container">
        <input
          type="text"
          class="form-control search-input"
          placeholder="Search..."
        />
        <i class="bi bi-search search-icon"></i>
      </div>
    </div>
  </div>
  <!-- END Search input -->

  <!-- Results -->
  <div class="container pt-5">
    <div class="row g-4 justify-content-start">
      <!-- Loading state -->
      @if (loading()) {
        <div class="text-center">
          <p class="text-muted">Loading...</p>
        </div>
      }
      <!-- END Loading state -->
      @else {
        <!-- Empty state -->
        @if (books() && books().length === 0) {
          <div class="text-center">
            <p class="text-muted">No books found.</p>
          </div>
        }
        <!-- END Empty state -->
        @else {
          <!-- Books loop -->
          @for (book of books(); track book.id) {
            <!-- Book column -->
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
              <!-- Book card -->
              <div
                class="card book-card border-0 rounded-4 shadow-sm h-100 d-flex flex-column"
              >
                <!-- Card image -->
                <div
                  class="ratio bg-light overflow-hidden p-2"
                  style="--bs-aspect-ratio: 75%"
                >
                  <div
                    class="d-flex align-items-center justify-content-center h-100 w-100"
                  >
                    <img
                      src="{{ book.imageUrl }}"
                      class="img-fluid"
                      alt="{{ book.title }} cover"
                      style="
                        object-fit: contain;
                        max-height: 100%;
                        width: auto;
                        display: block;
                      "
                    />
                  </div>
                </div>
                <!-- END Card image / media -->

                <!-- Card body -->
                <div class="card-body p-3 d-flex flex-column flex-grow-1">
                  <!-- Title / author -->
                  <h5 class="card-title fw-bold mb-1" title="{{ book.title }}">
                    {{ book.title }}
                  </h5>
                  <h6
                    class="card-subtitle text-muted mb-2 small text-truncate"
                    title="{{ book.authors }}"
                  >
                    {{ book.authors }}
                  </h6>
                  <!-- END Title / author -->

                  <!-- Categories -->
                  <div class="mb-2 categories-preview">
                    @if (book.categories && book.categories.length) {
                      @for (category of book.categories.slice(0,2); track category) {
                        <span
                          class="badge bg-secondary small py-1 px-2 me-1 text-truncate"
                          style="max-width: 8rem"
                          title="{{ category }}"
                          >{{ category }}</span
                        >
                      }

                      @if (book.categories.length > 2) {
                        <details class="categories-details">
                          <summary class="categories-summary">+{{ book.categories.length - 2 }} more</summary>
                          <div class="mt-2 d-flex flex-column gap-1">
                            @for (cat of book.categories; track cat) {
                              <span class="badge bg-secondary small py-1 px-2" title="{{ cat }}">{{ cat }}</span>
                            }
                          </div>
                        </details>
                      }
                    } @else {
                      <span class="badge bg-secondary small py-1 px-2" title="Uncategorized">Uncategorized</span>
                    }
                  </div>
                  <!-- END Categories -->

                  <!-- Rating and average -->
                  <div
                    class="mt-auto d-flex justify-content-between align-items-center gap-2"
                  >
                    <span
                      class="rating d-flex align-items-center gap-1"
                      aria-label="Rating"
                    >
                      @for (i of [1,2,3,4,5]; track i) {
                        @if (book.averageRating >= i) {
                          <i class="bi bi-star-fill text-warning" aria-hidden="true"></i>
                        } @else {
                          @if (book.averageRating >= i - 0.5) {
                            <i class="bi bi-star-half text-warning" aria-hidden="true"></i>
                          } @else {
                            <i class="bi bi-star text-warning" aria-hidden="true"></i>
                          }
                        }
                      }
                    </span>

                    <div
                      class="badge bg-light text-dark border rounded-pill py-1 px-2"
                      title="Average rating"
                    >
                      <span class="fw-semibold small">{{ book.averageRating }}</span>
                    </div>
                  </div>
                  <!-- END Rating and average -->

                </div>
                <!-- END Card body -->

              </div>
              <!-- END Book card -->
            </div>
            <!-- END Book column -->
          }
          <!-- END SubBooks loop -->
        }
      }
    </div>
  </div>
  <!-- END Results -->
</div>
