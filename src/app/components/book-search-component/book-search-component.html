<div class="container py-5 text-center">
  <!-- Hero -->
  <h1 class="h4 fw-bold mb-2">Search to find your new book</h1>
  <p class="text-muted mb-3">
    Search for books by title, author, or ISBN to find your next great read.
  </p>
  <!-- END Hero -->

  <!-- Search input -->
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="search-container">
        <input
          id="search-input"
          name="search"
          type="text"
          class="form-control search-input"
          placeholder="Search..."
          (input)="onSearch($event.target.value)"
        />
        <i class="bi bi-search search-icon"></i>
      </div>
    </div>
  </div>
  <!-- END Search input -->

  <!-- Filters -->
  <form class="container mt-4" role="search" aria-label="Book filters">
    <div class="row g-2 align-items-center filters-row justify-content-center">
      <div class="col-12 col-sm-6 col-md-3">
        <label class="visually-hidden" for="category-filter">Category</label>
        <div class="input-group">
          <span class="input-group-text d-flex align-items-center justify-content-center"><i class="bi bi-tags" aria-hidden="true"></i></span>
          <select id="category-filter" name="category" class="form-select" aria-label="category filter" (change)="onFilterChange('category', $event)">
            <option value="all" selected>All categories</option>
            <option value="Programming">Programming</option>
            <option value="JavaScript">JavaScript</option>
            <option value="ES6">ES6</option>
            <option value="Design Patterns">Design Patterns</option>
            <option value="Advanced">Advanced</option>
            <option value="Web Development">Web Development</option>
            <option value="Git">Git</option>
          </select>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <label class="visually-hidden" for="year-filter">Year</label>
        <div class="input-group">
          <span class="input-group-text d-flex align-items-center justify-content-center"><i class="bi bi-calendar3" aria-hidden="true"></i></span>
          <select id="year-filter" name="year" class="form-select" aria-label="year filter" (change)="onFilterChange('year', $event)">
            <option value="all" selected>All years</option>
            <option value="2023">2023</option>
            <option value="2022">2022</option>
            <option value="2021">2021</option>
            <option value="2020">2020</option>
            <option value="2019">2019</option>
            <option value="2018">2018</option>
            <option value="2017">2017</option>
            <option value="2016">2016</option>
            <option value="2015">2015</option>
            <option value="2014">2014</option>
            <option value="2013">2013</option>
            <option value="2012">2012</option>
            <option value="2011">2011</option>
            <option value="2010">2010</option>
            <option value="2009">2009</option>
          </select>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <label class="visually-hidden" for="publisher-filter">Publisher</label>
        <div class="input-group">
          <span class="input-group-text d-flex align-items-center justify-content-center"><i class="bi bi-building" aria-hidden="true"></i></span>
          <select id="publisher-filter" name="publisher" class="form-select" aria-label="publisher filter" (change)="onFilterChange('publisher', $event)">
            <option value="all" selected>All publishers</option>
            <option value="Apress">Apress</option>
            <option value="No Starch Press">No Starch Press</option>
            <option value="O'Reilly Media">O'Reilly Media</option>
            <option value="Addison-Wesley Professional">Addison-Wesley Professional</option>
            <option value="Leanpub">Leanpub</option>
            <option value="GitHub">GitHub</option>
            <option value="Independently published">Independently published</option>
            <option value="Self-Published">Self-Published</option>
            <option value="Unknown">Unknown</option>
          </select>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <label class="visually-hidden" for="rating-filter">Rating</label>
        <div class="input-group">
          <span class="input-group-text d-flex align-items-center justify-content-center"><i class="bi bi-star" aria-hidden="true"></i></span>
          <select id="rating-filter" name="rating" class="form-select" aria-label="rating filter" (change)="onFilterChange('rating', $event)">
            <option value="all" selected>All ratings</option>
            <option value="1">1+</option>
            <option value="2">2+</option>
            <option value="3">3+</option>
            <option value="4">4+</option>
          </select>
        </div>
      </div>
    </div>
  </form>
  <!-- END Filters -->

  <!-- Results -->
  <div class="container pt-5">
    <div class="row g-4 justify-content-start">
      <!-- Loading state -->
      @if (loading()) {
        <div class="text-center">
          <p class="text-muted">Loading...</p>
        </div>
      }
      <!-- END Loading state -->
      @else {
        <!-- Empty state -->
        @if (books() && books().length === 0) {
          <div class="text-center">
            <p class="text-muted">No books found.</p>
          </div>
        }
        <!-- END Empty state -->
        @else {
          <!-- Books loop -->
          @for (book of books(); track book.id) {
            <!-- Book column -->
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
              <!-- Book card -->
              <div
                class="card book-card border-0 rounded-4 shadow-sm h-100 d-flex flex-column"
              >
                <!-- Card image -->
                <div
                  class="ratio bg-light overflow-hidden p-2"
                  style="--bs-aspect-ratio: 75%"
                >
                  <div
                    class="d-flex align-items-center justify-content-center h-100 w-100"
                  >
                    <img
                      src="{{ book.imageUrl }}"
                      class="img-fluid"
                      alt="{{ book.title }} cover"
                      style="
                        object-fit: contain;
                        max-height: 100%;
                        width: auto;
                        display: block;
                      "
                    />
                  </div>
                </div>
                <!-- END Card image / media -->

                <!-- Card body -->
                <div class="card-body p-3 d-flex flex-column flex-grow-1">
                  <!-- Title / author -->
                  <h5 class="card-title fw-bold mb-1" title="{{ book.title }}">
                    {{ book.title }}
                  </h5>
                  <h6
                    class="card-subtitle text-muted mb-2 small text-truncate"
                    title="{{ book.authors }}"
                  >
                    {{ book.authors }}
                  </h6>
                  <!-- END Title / author -->

                  <!-- Categories -->
                  <div class="mb-2 categories-preview">
                    @if (book.categories && book.categories.length) {
                      @for (category of book.categories.slice(0,2); track category) {
                        <span
                          class="badge bg-secondary small py-1 px-2 me-1 text-truncate"
                          style="max-width: 8rem"
                          title="{{ category }}"
                          >{{ category }}</span
                        >
                      }

                      @if (book.categories.length > 2) {
                        <details class="categories-details">
                          <summary class="categories-summary">+{{ book.categories.length - 2 }} more</summary>
                          <div class="mt-2 d-flex flex-column gap-1">
                            @for (cat of book.categories; track cat) {
                              <span class="badge bg-secondary small py-1 px-2" title="{{ cat }}">{{ cat }}</span>
                            }
                          </div>
                        </details>
                      }
                    } @else {
                      <span class="badge bg-secondary small py-1 px-2" title="Uncategorized">Uncategorized</span>
                    }
                  </div>
                  <!-- END Categories -->

                  <!-- Rating and average -->
                  <div
                    class="mt-auto d-flex justify-content-between align-items-center gap-2"
                  >
                    <span
                      class="rating d-flex align-items-center gap-1"
                      aria-label="Rating"
                    >
                      @for (i of [1,2,3,4,5]; track i) {
                        @if (book.averageRating >= i) {
                          <i class="bi bi-star-fill text-warning" aria-hidden="true"></i>
                        } @else {
                          @if (book.averageRating >= i - 0.5) {
                            <i class="bi bi-star-half text-warning" aria-hidden="true"></i>
                          } @else {
                            <i class="bi bi-star text-warning" aria-hidden="true"></i>
                          }
                        }
                      }
                    </span>

                    <div
                      class="badge bg-light text-dark border rounded-pill py-1 px-2"
                      title="Average rating"
                    >
                      <span class="fw-semibold small">{{ book.averageRating || '-' }}</span>
                    </div>
                  </div>
                  <!-- END Rating and average -->

                </div>
                <!-- END Card body -->

              </div>
              <!-- END Book card -->
            </div>
            <!-- END Book column -->
          }
          <!-- END SubBooks loop -->
        }
      }
    </div>
  </div>
  <!-- END Results -->
</div>
