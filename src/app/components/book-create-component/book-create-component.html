<!-- Add Book Modal -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" data-bs-backdrop="static"
  data-bs-keyboard="false">
  <div class="modal-dialog modal-lg modal-dialog-scrollable modal-fullscreen-sm-down">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="addModalLabel">Add Book</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="onClose()"></button>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()" id="addBookForm">
        <div class="modal-body">
          <!-- Basic Information -->
          <div class="mb-4">
            <h5 class="mb-3">Basic Information</h5>
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label">Title <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="title" />
                @if (form.get('title')?.invalid && form.get('title')?.touched) {
                <div class="text-danger">Required</div>
                }
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Subtitle <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="subtitle" />
                @if (form.get('subtitle')?.invalid && form.get('subtitle')?.touched) {
                <div class="text-danger">Required</div>
                }
              </div>

              <div class="col-12">
                <label class="form-label">Authors <span class="text-danger">*</span></label>

                <div class="mb-2">
                  <ng-container *ngFor="let ctrl of authorsArray.controls; let i = index">
                    <span class="badge bg-secondary me-1">
                      {{ ctrl.value }}
                      <button type="button" class="btn-close btn-close-white btn-sm ms-2" aria-label="Remove"
                        (click)="removeAuthor(i)"></button>
                    </span>
                  </ng-container>
                </div>

                <div class="input-group mb-2">
                  <input #authorInput type="text" class="form-control" placeholder="Add author and press Enter"
                    (keydown.enter)="addAuthor(authorInput.value); authorInput.value=''; $event.preventDefault()" />
                  <button type="button" class="btn btn-outline-secondary"
                    (click)="addAuthor(authorInput.value); authorInput.value=''">Add</button>
                </div>

                @if (authorsArray.invalid && authorsArray.touched) {
                <div class="text-danger">Required</div>
                }
              </div>
            </div>
          </div>

          <!-- Publication Details -->
          <div class="mb-4">
            <h5 class="mb-3">Publication Details</h5>
            <div class="row g-3">
              <div class="col-6 col-md-3">
                <label class="form-label">Year <span class="text-danger">*</span></label>
                <input type="number" class="form-control" formControlName="year" />
                @if (form.get('year')?.invalid && form.get('year')?.touched) {
                <div class="text-danger">Required</div>
                }
              </div>

              <div class="col-6 col-md-4">
                <label class="form-label">Publisher <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="publisher" />
                @if (form.get('publisher')?.invalid && form.get('publisher')?.touched) {
                <div class="text-danger">Required</div>
                }
              </div>

              <div class="col-6 col-md-4">
                <label class="form-label">Pages <span class="text-danger">*</span></label>
                <input type="number" class="form-control" formControlName="pages" min="1" />
                @if (form.get('pages')?.invalid && form.get('pages')?.touched) {
                <div class="text-danger">Required</div>
                }
              </div>
            </div>
          </div>

          <!-- Description -->
          <div class="mb-4">
            <h5 class="mb-3">Description</h5>
            <div class="row g-3">
              <div class="col-12">
                <label class="form-label">Description <span class="text-danger">*</span></label>
                <textarea class="form-control" rows="4" formControlName="description"></textarea>
                @if (form.get('description')?.invalid && form.get('description')?.touched) {
                <div class="text-danger">Required</div>
                }
              </div>
            </div>
          </div>

          <!-- Media -->
          <div class="mb-4">
            <h5 class="mb-3">Media</h5>
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label">Image URL <span class="text-danger">*</span></label>
                <input type="url" class="form-control" formControlName="imageUrl" />
                @if (form.get('imageUrl')?.invalid && form.get('imageUrl')?.touched) {
                <div class="text-danger">Required</div>
                }
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Website <span class="text-danger">*</span></label>
                <input type="url" class="form-control" formControlName="website" />
                @if (form.get('website')?.invalid && form.get('website')?.touched) {
                <div class="text-danger">Required</div>
                }
              </div>
            </div>
          </div>

          <!-- Categories and Ratings -->
          <div class="mb-4">
            <h5 class="mb-3">Categories and Ratings</h5>
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label">Categories <span class="text-danger">*</span></label>

                <div class="mb-2">
                  <ng-container *ngFor="let ctrl of categoriesArray.controls; let i = index">
                    <span class="badge bg-info text-dark me-1">
                      {{ ctrl.value }}
                      <button type="button" class="btn-close btn-close-white btn-sm ms-2" aria-label="Remove"
                        (click)="removeCategory(i)"></button>
                    </span>
                  </ng-container>
                </div>

                <div class="input-group mb-2">
                  <input #categoryInput type="text" class="form-control" placeholder="Add category and press Enter"
                    (keydown.enter)="addCategory(categoryInput.value); categoryInput.value=''; $event.preventDefault()" />
                  <button type="button" class="btn btn-outline-secondary"
                    (click)="addCategory(categoryInput.value); categoryInput.value=''">Add</button>
                </div>

                @if (categoriesArray.invalid && categoriesArray.touched) {
                <div class="text-danger">Required</div>
                }
              </div>

              <div class="col-6 col-md-3">
                <label class="form-label">Average Rating <span class="text-danger">*</span></label>
                <input type="number" step="0.1" min="0" max="5" class="form-control" formControlName="averageRating" />
                @if (form.get('averageRating')?.invalid && form.get('averageRating')?.touched) {
                <div class="text-danger">Required</div>
                }
              </div>
            </div>
          </div>

          <!-- Identifiers -->
          <div class="mb-4">
            <h5 class="mb-3">Identifiers</h5>
            <div class="row g-3">
              <div class="col-6 col-md-3">
                <label class="form-label">ISBN-13 <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="isbn13" />
                @if (form.get('isbn13')?.invalid && form.get('isbn13')?.touched) {
                <div class="text-danger">Required</div>
                }
              </div>

              <div class="col-6 col-md-3">
                <label class="form-label">ISBN-10 <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="isbn10" />
                @if (form.get('isbn10')?.invalid && form.get('isbn10')?.touched) {
                <div class="text-danger">Required</div>
                }
              </div>
            </div>
          </div>
        </div>
      </form>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="onClose()">Close</button>
        <button type="submit" class="btn btn-primary" form="addBookForm" data-bs-dismiss="modal"
          [disabled]="form.invalid || isSubmitting()">
          @if (isSubmitting()) {
          Saving...
          }
          @else {
          Save
          }
        </button>
      </div>
    </div>
  </div>
</div>
<!-- END Add Book Modal -->